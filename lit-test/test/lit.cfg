import os, subprocess
import lit.util
import lit.formats

root = os.path.join(os.path.dirname(__file__), '..')

config.name = 'ARTIQ'
config.test_format = lit.formats.ShTest()
config.suffixes = ['.py']

python_executable = 'python3'
harness = '{} {}'.format(python_executable, os.path.join(root, 'harness.py'))
config.substitutions.append( ('%python', harness) )

if os.name == 'posix':
    personality_build = os.path.join(root, 'libartiq_personality')
    if subprocess.call(['make', '-sC', personality_build]) != 0:
        lit_config.fatal("Unable to build JIT support library")

    personality_lib = os.path.join(personality_build, 'libartiq_personality.so')
    config.substitutions.append( ('%personality', personality_lib) )

    config.available_features.add('exceptions')
